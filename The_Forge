--== AUTO FARM SECTION ==--

local AutoFarm = false
local SelectedMob = nil

local MobList = {
	"Zombie",
	"Delver Zombie",
	"Delivery Zombie"
}

Window:AddDropdown({
	Title = "Chọn quái để farm",
	Description = "Danh sách quái",
	Tab = Main,
	Options = MobList,
	Callback = function(v)
		SelectedMob = v
	end,
})

Window:AddToggle({
	Title = "Auto Farm",
	Description = "Tự động farm quái",
	Tab = Main,
	Callback = function(v)
		AutoFarm = v
	end,
})

--== AUTO FARM LOGIC ==--

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

-- Auto equip weapon
local function equipWeapon()
	local tools = lp.Backpack:GetChildren()
	for _, tool in pairs(tools) do
		if tool:IsA("Tool") then
			tool.Parent = char
			return
		end
	end
end

-- Find nearest selected mob
local function getMob()
	local target = nil
	local dist = math.huge

	for _, mob in ipairs(workspace:GetChildren()) do
		if mob.Name == SelectedMob and mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") then
			local d = (hrp.Position - mob.HumanoidRootPart.Position).Magnitude
			if d < dist then
				dist = d
				target = mob
			end
		end
	end

	return target
end

RunService.RenderStepped:Connect(function()
	if AutoFarm and SelectedMob then

		equipWeapon()

		local mob = getMob()
		if mob then
			local mobHRP = mob:FindFirstChild("HumanoidRootPart")
			if mobHRP then

				-- Teleport xuống dưới chân quái 5 studs
				hrp.CFrame = mobHRP.CFrame * CFrame.new(0, -3, 5)

				-- Xoay mặt nhìn thẳng vào quái
				hrp.CFrame = CFrame.lookAt(hrp.Position, mobHRP.Position)

				-- Auto attack (nếu tool có handle / activate)
				if char:FindFirstChildWhichIsA("Tool") then
					char:FindFirstChildWhichIsA("Tool"):Activate()
				end
			end
		end
	end
end)
